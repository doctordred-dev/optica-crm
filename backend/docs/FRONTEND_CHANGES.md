# Изменения API для фронтенда

## Дата: 20 января 2026

### Обзор изменений

Внесены изменения в модели `Order` и `Client` для расширения функционала системы управления заказами оптики.

---

## 1. Новые поля в рецепте (Prescription)

### Добавлены поля:

#### `prescription.masterWorkCost` (Вартість роботи майстра)
- **Тип:** Number
- **Обязательное:** Нет
- **Значение по умолчанию:** 0
- **Минимум:** 0
- **Описание:** Стоимость работы мастера по изготовлению очков

#### `prescription.prescriptionOrderDate` (Дата замовлення по рецепту)
- **Тип:** Date (ISO 8601 формат)
- **Обязательное:** Нет
- **Описание:** Дата заказа по рецепту

### Пример использования при создании заказа:

```json
POST /api/orders
{
  "clientId": "507f1f77bcf86cd799439011",
  "employeeId": "507f1f77bcf86cd799439012",
  "productType": "очки",
  "prescription": {
    "rightEye": {
      "sphere": "+2.5",
      "cylinder": "-0.75",
      "axis": 90
    },
    "leftEye": {
      "sphere": "+2.0",
      "cylinder": "-0.5",
      "axis": 85
    },
    "pd": 65,
    "purpose": "для постоянного ношения",
    "masterWorkCost": 500,
    "prescriptionOrderDate": "2026-01-20T10:30:00.000Z"
  },
  "totalPrice": 3500
}
```

### Пример ответа при получении заказа:

```json
GET /api/orders/:id
{
  "success": true,
  "data": {
    "order": {
      "_id": "507f1f77bcf86cd799439011",
      "clientId": {...},
      "prescription": {
        "rightEye": {
          "sphere": "+2.5",
          "cylinder": "-0.75",
          "axis": 90
        },
        "leftEye": {
          "sphere": "+2.0",
          "cylinder": "-0.5",
          "axis": 85
        },
        "pd": 65,
        "purpose": "для постоянного ношения",
        "masterWorkCost": 500,
        "prescriptionOrderDate": "2026-01-20T10:30:00.000Z"
      },
      ...
    }
  }
}
```

---

## 2. Изменение формата диоптрий (Sphere и Cylinder)

### ⚠️ КРИТИЧЕСКОЕ ИЗМЕНЕНИЕ

Поля `sphere` и `cylinder` для обоих глаз теперь имеют тип **String** вместо **Number**.

### Требования к формату:

- **Обязательно** должны начинаться со знака `+` или `-`
- Поддерживаются целые числа и десятичные дроби
- Примеры валидных значений: `"+2.5"`, `"-1.75"`, `"+0.5"`, `"-3.0"`
- Примеры НЕвалидных значений: `"2.5"`, `"1.75"`, `0.5` (без знака или число)

### Валидация на фронтенде:

```javascript
// Регулярное выражение для валидации
const diopterRegex = /^[+-]\d+(\.\d+)?$/;

// Пример функции валидации
function validateDiopter(value) {
  if (!value) return true; // Пустое значение допустимо
  return diopterRegex.test(value);
}

// Пример использования в форме
const handleDiopterInput = (value) => {
  if (!value.startsWith('+') && !value.startsWith('-')) {
    // Автоматически добавить знак + если пользователь не ввел знак
    return '+' + value;
  }
  return value;
};
```

### Изменения в UI:

1. **Input поля для sphere и cylinder:**
   - Добавить placeholder: `"+0.00"` или `"-0.00"`
   - Добавить кнопки быстрого выбора знака (+/-)
   - Показывать ошибку валидации если знак отсутствует

2. **Отображение значений:**
   - Всегда показывать знак: `"+2.5"`, `"-1.75"`



## 3. Множественные клиенты с одним номером телефона

### Изменение:

Удалено ограничение `unique` для поля `phone` в модели `Client`.

### Что это означает:

- Теперь можно создавать **несколько клиентов** с одинаковым номером телефона
- Это полезно для семей или когда несколько членов семьи используют один контактный номер

### Изменения в UI:

1. **При поиске клиента по телефону:**
   - Может вернуться несколько результатов
   - Показывать список всех клиентов с данным номером
   - Добавить дополнительную информацию для различения (имя, возраст, дата последнего заказа)



## Контрольный список для фронтенд-разработчика

### Формы создания/редактирования заказа:

- [ ] Добавить поле "Вартість роботи майстра" (masterWorkCost) в секцию рецепта
- [ ] Добавить поле "Дата замовлення по рецепту" (prescriptionOrderDate) в секцию рецепта
- [ ] Изменить input для sphere и cylinder на текстовые поля
- [ ] Добавить валидацию для sphere и cylinder (обязательный знак +/-)
- [ ] Добавить автоматическое добавление знака "+" если пользователь не ввел знак
- [ ] Обновить placeholder для полей диоптрий

### Отображение заказов:

- [ ] Показывать "Вартість роботи майстра" в карточке заказа
- [ ] Показывать "Дата замовлення по рецепту" в карточке заказа
- [ ] Обеспечить корректное отображение диоптрий со знаками

### Работа с клиентами:

- [ ] Обработать случай множественных клиентов с одним номером
- [ ] Добавить модальное окно выбора клиента при поиске по телефону
- [ ] Добавить предупреждение при создании клиента с существующим номером
- [ ] Обновить логику автозаполнения при вводе номера телефона

### Тестирование:

- [ ] Протестировать создание заказа с новыми полями
- [ ] Протестировать валидацию диоптрий
- [ ] Протестировать создание нескольких клиентов с одним номером
- [ ] Протестировать поиск клиентов по номеру телефона
- [ ] Проверить отображение существующих заказов с новыми полями

---



## Вопросы и поддержка

Если возникнут вопросы по интеграции этих изменений, обращайтесь к бэкенд-команде.

**Дата последнего обновления:** 20 января 2026
